name: Java CI
# on every push on develop branch
  push:
    branches:
      - develop

jobs:
  maven-build:
    # we start from a ubuntu machine
    runs-on: Linux

    steps:
      #we get the content of the repository
      - uses: actions/checkout@v2
      # install a JDK8
      - name: Set up JDK 1.8
        uses: actions/setup-java@v1
        with:
          java-version: 1.8
      # sets a cache betwwen builds for the maven repository
      - name: Cache Maven packages
        uses: actions/cache@v2
        with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}
          restore-keys: ${{ runner.os }}-m2
      # and build the projet with a specific maven settings.xml
      # it contains env variables from github secrets for the credentials
      # to github, dockerhub and bintray
      - name: Build with Maven
        run: mvn -B --settings ci-settings.xml verify deploy-site
